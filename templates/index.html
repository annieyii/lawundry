<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trademark Comparison System</title>
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">Trademark Comparison System</div>
            <div class="nav"> 
              <a href="/about" class="nav-link">About Us</a>
              <a href="/index" class="nav-link">Comprision System</a>
            </div>
        </div> 
<!--圖片上傳-->
        <div class="content">
            <div class="section">
              <div class="section-title">Compare Images Easily</div>
              <div class="section-subtitle">Upload two images and see the differences side by side</div>
              <div class="upload-container">
                <div class="image-upload">
                    <div class="image-box" id="image-box1">image 1</div>
                    <div class="upload-button" onclick="document.getElementById('file-input1').click();">Upload Image</div>
                    <input type="file" id="file-input1" style="display: none;" onchange="uploadImage('image-box1', 'file-input1')">
                </div>
                <div class="image-upload">
                    <div class="image-box" id="image-box2">image 2</div>
                    <div class="upload-button" onclick="document.getElementById('file-input2').click();">Upload Image</div>
                    <input type="file" id="file-input2" style="display: none;" onchange="uploadImage('image-box2', 'file-input2')">
                </div>
                
              </div>
            </div>
            <div class="divider"></div>
<!--輸出結果-->
            <div id="post-upload-content" style="display: none;">
<!--overall cmp-->                
                <div class="section">
                    <div class="section-title">Overall Comparison</div>
                    <div class="section-subtitle">Comparing entire images through SSIM and HSV</div>
                    
                    <div class="result-items-row"> 
                        <div class="result-item">
                            <div class="result-description">SSIM</div>                               
                            <div class="result-value" id="ssim-result"></div>
                        </div>
                        <div class="result-item">
                            <div class="result-description">HSV</div>
                            <div class="result-value" id="hsv-result"></div>
                        </div>
                    </div>

                </div>
                <div class="divider"></div>
<!--partial cmp-->
                <div class="section">
                    <div class="section-title">Partial Feature Comparison</div>
                    <div class="section-subtitle">Comparing YOLO-extracted features using SSIM and HSV.</div>
                    <div class="feature-selection-container">
                        <div class="feature-selection-row1">
                            <div class="feature-images">image 1</div>
                            <div class="feature-selection-item">
                                <input type="checkbox" id="feature1" name="feature1">
                                <label for="feature1">person</label>
                            </div>
                        </div>
                        <div class="feature-divider"></div>
                        <div class="feature-selection-row2">
                            <div class="feature-images">image 2</div>
                            <div class="feature-selection-item">
                                <input type="checkbox" id="feature2" name="feature4">
                                <label for="feature4">elephant</label>
                            </div>
                        </div>
                    </div>
                    <div class="submit-button-container">
                        <button class="upload-button" onclick="submitFeatures()">Submit</button>
                    </div>
                    <div id="partial-selection" style="display: none;">
                        <div class="partial-image-container">
                            <div class="image-box" id="image-feature1">image 1</div>
                            <div class="image-box" id="image-feature2">image 2</div>
                        </div>
                        
                        <div class="result-items-row"> 
                            <div class="result-item">
                                <div class="result-description">SSIM</div>                               
                                <div class="result-value">37.27%</div>                                
                            </div>
                            <div class="result-item">
                                <div class="result-description">HSV</div>
                                <div class="result-value">6.52%</div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="divider"></div>            
                </div>
            </div>
<!--尾巴-->
{% include 'footer.html' %}
    
<!--script-->
<script>
    function uploadImage(imageBoxId, fileInputId) {
        const fileInput = document.getElementById(fileInputId);
        const formData = new FormData();
        formData.append('file', fileInput.files[0]);

        fetch('/upload', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById(imageBoxId).innerHTML = '<img src="' + data.url + '" alt="Uploaded Image" style="width: 100%; height: 100%;">';

                // 檢查兩個圖片是否都已經上傳
                const imageBox1 = document.getElementById('image-box1');
                const imageBox2 = document.getElementById('image-box2');
                if (imageBox1.innerHTML !== 'image 1' && imageBox2.innerHTML !== 'image 2') {
                    // 发送请求执行 .sh 文件
                    fetch('/run-script', {
                        method: 'POST'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            document.getElementById('ssim-result').innerText = data.ssim;
                            document.getElementById('hsv-result').innerText = data.hsv;
                            console.log('Script executed successfully.');
                            
                            // 如果兩個圖片都已經上傳，則顯示 #post-upload-content
                            document.getElementById('post-upload-content').style.display = 'block';
                            } else {
                                alert('Script execution failed.');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('Script execution failed.');
                        });
                }
            } else {
                alert('Image upload failed.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Image upload failed.');
        });
    }
</script>
    
<script>
    // 獲取所有的 feature-selection-row
    var rows1 = document.querySelectorAll('.feature-selection-row1');

    // 為每個 feature-selection-row 處理其內部的 checkbox
    for (var i = 0; i < rows1.length; i++) {
        // 獲取當前 row 內的所有 checkbox
        var checkboxes1 = rows1[i].querySelectorAll('input[type="checkbox"]');

        // 為每個 checkbox 添加一個事件監聽器
        for (var j = 0; j < checkboxes1.length; j++) {
            checkboxes1[j].addEventListener('change', function(e) {
                // 如果當前的 checkbox 被選中
                if (e.target.checked) {
                    // 取消選中同一個 row 內的其他 checkbox
                    for (var k = 0; k < checkboxes1.length; k++) {
                        if (checkboxes1[k] !== e.target) {
                            checkboxes1[k].checked = false;
                        }
                    }
                }
            });
        }
    }

    // 獲取所有的 feature-selection-row
    var rows2 = document.querySelectorAll('.feature-selection-row2');

    // 為每個 feature-selection-row 處理其內部的 checkbox
    for (var i = 0; i < rows2.length; i++) {
        // 獲取當前 row 內的所有 checkbox
        var checkboxes2 = rows2[i].querySelectorAll('input[type="checkbox"]');

        // 為每個 checkbox 添加一個事件監聽器
        for (var j = 0; j < checkboxes2.length; j++) {
            checkboxes2[j].addEventListener('change', function(e) {
                // 如果當前的 checkbox 被選中
                if (e.target.checked) {
                    // 取消選中同一個 row 內的其他 checkbox
                    for (var k = 0; k < checkboxes2.length; k++) {
                        if (checkboxes2[k] !== e.target) {
                            checkboxes2[k].checked = false;
                        }
                    }
                }
            });
        }
    }
</script>
<script>
    function submitFeatures() {
        // 獲取 feature-selection-row1 和 feature-selection-row2 中的所有 checkbox
        var checkboxes1 = document.querySelectorAll('.feature-selection-row1 input[type="checkbox"]');
        var checkboxes2 = document.querySelectorAll('.feature-selection-row2 input[type="checkbox"]');

        // 檢查 feature-selection-row1 和 feature-selection-row2 中是否至少有一個 checkbox 被選取
        var isAnyCheckboxChecked1 = Array.from(checkboxes1).some(checkbox => checkbox.checked);
        var isAnyCheckboxChecked2 = Array.from(checkboxes2).some(checkbox => checkbox.checked);

        // 獲取要顯示或隱藏的元素
        var content = document.getElementById('partial-selection');

        // 如果 feature-selection-row1 和 feature-selection-row2 中都至少有一個 checkbox 被選取
        if (isAnyCheckboxChecked1 && isAnyCheckboxChecked2) {
            document.getElementById('image-feature1').innerHTML = '<img src="/static/images/pic1.png" alt="Image 1" style="width: 100%; height: 100%;">';
            document.getElementById('image-feature2').innerHTML = '<img src="/static/images/pic2.png" alt="Image 2" style="width: 100%; height: 100%;">';
            // 顯示元素
            content.style.display = 'block';
        } else {
            // 隱藏元素
            content.style.display = 'none';
        }
    }
</script>
</body>
</html>
